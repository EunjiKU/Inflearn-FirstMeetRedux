<!DOCTYPE html>
<html lang="en">
<head>
  <title>ì²˜ìŒ ë§Œë‚œ ë¦¬ë•ìŠ¤ - Counter</title>
  <script src="https://unpkg.com/redux@4.2.1/dist/redux.min.js"></script>
</head>
<body>
  <h3>ì˜¤ëŠ˜ í•  ì¼</h3>
  <ul id="todo-list"></ul>
  <div>
    <input id="input-text" type="text">
    <button id="add-button">í•  ì¼ ì¶”ê°€</button>
    <button id="remove-button">í•  ì¼ ì‚­ì œ</button>
    <button id="remove-all-button">ëª¨ë‘ ì‚­ì œ</button>
    <button id="logging-state">State Logging</button>
  </div>

  <h3>ë©”ëª¨</h3>
  <ul id="memo-list"></ul>
  <div>
    <input id="input-memo-text" type="text">
    <button id="add-memo-button">í•  ì¼ ì¶”ê°€</button>
    <button id="remove-memo-button">í•  ì¼ ì‚­ì œ</button>
  </div>

  <script>
    // ğŸ’›TODO
    var  ACTION_TYPE_ADD_TODO = "ADD_TODO";
    var  ACTION_TYPE_REMOVE_TODO = "REMOVE_TODO";
    var  ACTION_TYPE_REMOVE_ALL = "REMOVE_ALL";
    // ğŸ§¡MEMO
    var  ACTION_TYPE_ADD_MEMO = "ADD_MEMO";
    var  ACTION_TYPE_REMOVE_MEMO = "REMOVE_MEMO";

    var todoInitialState = [];
    var memoInitialState = [];

    // ğŸ’›TODO
    const todoReducer = (state = todoInitialState, action) => {
      switch (action.type) {
        case ACTION_TYPE_ADD_TODO:
          return state.concat(action.text);
        case ACTION_TYPE_REMOVE_TODO:
          return state.slice(0, -1);
        case ACTION_TYPE_REMOVE_ALL:
          return [];
        default:
          return state;
      }
    }
    // ğŸ§¡MEMO
    const memoReducer = (state = memoInitialState, action) => {
      switch (action.type) {
        case ACTION_TYPE_ADD_MEMO:
          return state.concat(action.text)
        case ACTION_TYPE_REMOVE_MEMO:
          return state.slice(0, -1);
        default:
          return state;
      }
    }

    // function loggerMiddleware(store) {
    function loggerMiddleware({ getState }) { // Destructuring êµ¬ì¡°ë¶„í•´í• ë‹¹
      return (next) => (action) => {
        console.log("dispatch ì˜ˆì • action", action);

        // Middleware chainì´ ìˆëŠ” ë‹¤ìŒ dispatch í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
        const returnValue = next(action);

        console.log("dispatch ì´í›„ state", getState());

        return returnValue;
      }
    }

    var rootReducer = Redux.combineReducers({
      todo: todoReducer,
      memo: memoReducer
    })

    const store = Redux.createStore(
      rootReducer,
      Redux.applyMiddleware(loggerMiddleware)
    );

    const todoListElem = document.getElementById("todo-list");
    const memoListElem = document.getElementById("memo-list");
    const inputElem = document.getElementById("input-text");
    const inputMemoElem = document.getElementById("input-memo-text");

    function render() {
      // ğŸ’›TODO
      todoListElem.innerHTML = "";

      store.getState().todo.forEach((todo) => {
        const todoListItemElem = document.createElement("li");
        todoListItemElem.textContent = todo;
        todoListElem.appendChild(todoListItemElem);
      })
      // ğŸ§¡MEMO
      memoListElem.innerHTML = "";

      store.getState().memo.forEach((memo) => {
        const memoListItemElem = document.createElement("li");
        memoListItemElem.textContent = memo;
        memoListElem.appendChild(memoListItemElem);
      })
    }

    render();
    store.subscribe(render);

    // ğŸ’›TODO
    function addTodoActionCreator(text) {
      return {
        type: ACTION_TYPE_ADD_TODO,
        text: text
      }
    }
    function removeTodoActionCreator() {
      return {
        type: ACTION_TYPE_REMOVE_TODO,
      }
    }
    function removeAlloActionCreator() {
      return {
        type: ACTION_TYPE_REMOVE_ALL,
      }
    }
    // ğŸ§¡MEMO
    function addMemoActionCreator(text) {
      return {
        type: ACTION_TYPE_ADD_MEMO,
        text: text
      }
    }
    function removeMemoActionCreator() {
      return {
        type: ACTION_TYPE_REMOVE_MEMO,
      }
    }

    // ğŸ’›TODO
    document.getElementById("add-button").addEventListener("click", function() {
      // Actionì„ ì‹¤ì œë¡œ dispatch
      store.dispatch(addTodoActionCreator(inputElem.value));
      // Input ì´ˆê¸°í™”
      inputElem.value = "";
    })
    document.getElementById("remove-button").addEventListener("click", function() {
      store.dispatch(removeTodoActionCreator());
    })
    document.getElementById("remove-all-button").addEventListener("click", function() {
      store.dispatch(removeAlloActionCreator());
    })
    document.getElementById("logging-state").addEventListener("click", function() {
      console.log("í˜„ì¬ state", store.getState());;
    })
    // ğŸ§¡MEMO
    document.getElementById("add-memo-button").addEventListener("click", function() {
      store.dispatch(addMemoActionCreator(inputMemoElem.value));
      inputMemoElem.value = "";
    })
    document.getElementById("remove-memo-button").addEventListener("click", function() {
      store.dispatch(removeMemoActionCreator());
    })
  </script>
</body>
</html>